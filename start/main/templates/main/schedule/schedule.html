{% extends "main/base.html" %}
{% load static %}

{% block title %}Расписание{% endblock title %}

{% block content %}
<h2>График: {{ shop.name }} — {{ month }} / {{ year }}</h2>
{% comment %} <div class="mb-3">
    <a href="{% url 'schedule_month' shop.id year=(month == 1 and year-1 or year) month=(month == 1 and 12 or month-1) %}" class="btn btn-sm btn-outline-primary">&lt; Предыдущий</a>
    <a href="{% url 'schedule_month' shop.id year=(month == 12 and year+1 or year) month=(month == 12 and 1 or month+1) %}" class="btn btn-sm btn-outline-primary">Следующий &gt;</a>
</div> {% endcomment %}
<table border="1" class="table table-bordered">
    <thead>
        <tr>
            <th>Работник</th>
            {% for day in days %}
                <th>{{ day.day }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for worker in workers %}
            <tr>
                <td>{{ worker.name }}</td>
                {% for day in days %}
                    <td class="schedule-cell"></td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>

<div class="modal-window" id="modalWindow">
    <div class="modal-in">
        <div class="modal-buttons">
            <button class="modal-btn d-flex">7.30</button>
            <button class="modal-btn d-flex">8.00</button>
            <button class="modal-btn d-flex">9.30</button>
            <button class="modal-btn d-flex">10:00</button>
            <button class="modal-btn d-flex">+</button>
            {% for cafe in all_shops %}
                {% if cafe.id != shop.id %}
                    <button class="modal-btn-short-codes d-flex">{{ cafe.short_code }}</button>
                {% endif %}
            {% endfor %}
            <button class="modal-btn d-flex">Выходной</button>
            <button class="modal-btn-back d-flex">Отмена</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById('modalWindow');
        let currentCell = null;

        document.querySelectorAll('.schedule-cell').forEach(cell => {
            cell.addEventListener('click', function () {
                currentCell = this;
                modal.style.display = 'flex';
            });
        });

        modal.addEventListener('click', function (event) {
            const btn = event.target.closest('button');
            if (!btn) return;

            const text = btn.textContent.trim();

            if (text === 'Отмена') {
                modal.style.display = 'none';
                return;
            }

            if (text === 'Выходной') {
                currentCell.textContent = '';
            } else {
                currentCell.textContent = text;
            }

            modal.style.display = 'none';
        });

        window.addEventListener('click', function (event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
</script>
{% endblock content %}